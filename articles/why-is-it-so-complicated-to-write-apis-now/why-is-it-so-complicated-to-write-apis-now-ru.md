## Почему так сложно создавать APIs в современном мире – компьютеризированная бюрократия

--> [EN](why-is-it-so-complicated-to-write-apis-now-en.md) <--

Сейчас на минуточку второй июля 2024 года. Я строю сайты с 2006 года и по сей день. Когда то начиная с простейших html 
страниц хостящихся прямиком с апаче сервера, сейчас всё вертится в облаке, деплоится автоматически через стек и хостится
я если честно даже не знаю как, могу только догадываться и верить предложенной документации.

Начну с конца, что бы написать простенький GET API для JSON файлов в 2024 году в корпорации амазон мне потребовалось реально
практически месяц. Месяц работы включил планирование, создание контракта для API, его описание в языке представления Smithy
(что блять это такое и зачем оно нужно), пару недель гонять пулл-реквест (в амазоне он называется CR нахуя блять??) от одного
разработчика до другого с коментариями. В итоге замерджил это через пару недель после создания запроса с 4ой ревизии. До этого 
в амазоне у меня было ну максимум 3 ревизии, дно пробито. Блять нахуя городить смитти я не знаю. В итоге приступил я к разработке
самого API. Это просто REST GET запрос к серверу с одним параметром. Этот GET запрос должен выводить в прописанном в Smithy 
формате (ага когда блять уже есть JSON) контент файла который находится в JSON формате в сервисе AppConfig которые выбираются
в соответствии с заданным параметров в API.

Если словами быдло-кодера это скрипт который выдаёт файлы из сервера. Всё. Сам API я написал минут за 15. Потому что пришлось 
час потратить на чтение документации по AppConfig и поиску API спецификации к нему. Строк кода нуууу 200 сам API.

В 2006 году апаче сервер мог прочитать и выдать файл в 3-4её строках, если в БД то в 10 макс.

Хер с ним, написал, написал тесты что бы было покрытие 100% получилось уже 500 добавочных строк. Дальше библиотеки,
подключения новых параметров в стеке. И сам стэк.

Сам стэк, написан на внутреннем CDK на TypeScript. Что-то среднее между terraform и скриптами быдло кодеров в 2009 году для ползования
сервисами AWS. CDK служит для собственно создания деплоймента в AWS. И разбит на много компонентов. Но ключевые компоненты 
называются стэки. В стеках можно описать что угодно хоть нахуй сосдеа послать, но обычно создают базы данных, лямбды, клауд формейшены, 
да чего угодно. В моем же случае API был оформлен как лямбда функция. Я добавил лямбду и начал смотреть спецификацию которая требовала
параметры для подключения лямбды к AppConfig. К моему расстройству сам appConfig был объявлён в другом стеке. И не как отдельный стек,
а как ведомая часть другого сервисного стэка.

Когда я это увидел, на меня нахлынула ярость. Я уже и так дня 3 устанавливал стэк на свой AWS Account для тестов. А тут собственно мне 
никак не получить параметры нужные для чтения файлов из AppConfig из другого стэка нормальным путём кроме как переписать чужой стэк и 
вычленить из него AppConfig поместить в новый стек и сделать его как раздаваемая структура.

Фух подумал я, надо пройтись... достать Хаски-Колбаски и просто погулять что бы перестать думать об этой хуёвой работе. Немного отступления
что бы ускорить работу я часто прошу AI что-то сделать за меня. Это мне помогает настроиться на работу, потому что AI так плохо делает 
некоторые вещи что я расстраиваюсь и начинаю переделывать. Аналогично и тут, после прогулки я решил что надо попробовать дать AI шанс.
Попробовал раз 5-6 у меня получилось из рук вон плохо. Редактор ругался на код и его надо было переписывать. Но мелкие сгенерированные сниппеты
я всё же получил.

Поигрвшись с генератором кода, мне надо было поговорить с командой и убедить их что нужен новый стэк. А это собственно основная проблема
никто не любит переписывать то что работает и в итоге моя работа раздуется от этого. Но это пол беды. Все существующие стеки должны будут быть
обновлены с аккуратным удалением иначе деплоймент просто не будет работать. И это надо будет сделать всем, всем энваронментам, всем девелоперам
и их аккаунтам. Ладно что делать, написал. Удивительно быстро получилось убедить всех. В целом это даже всех удивило что это не был отдельный
стэк и видимо кто-то получит по шапке.

Работа закипела, сделав новый стэк, я расшарил параметры с моим лябмдовым и со старым тоже лямбдовым, но теперь облегчённым. Приятно смотреть
на более чистый код. Написал тесты и новый стэк наверное строк 300-400. Начал тестировать и конечно проблемы с диплоем даже в мой рабочий аккаунт
пару часов удалений и редеплоя – ура повяилось и работает.

Пошел тестировать API, заливаю конфигурационные файлы, не работает часть которая создаёт AppConfig, она работала до того как я приступил делать 
свою часть. Перебирая всё в голове что я мог потрогать за время разработки я понял что ничего из этого не трогал и это кто то другой. Стал смотреть
последние изменения и одновременно написал в чат что такое. В итоге нашёл что кто-то поставил доп фильтры на загрузку конфигураций и одновременно из
чата пришло сообщение что уже всё поменялось пока я разрабатывал API. Ну хотя бы работает подумал я и подправив файлы для фильтров залил конфигурации.
Они появились!!! УРА УРА!

Между делом уже идёт неделя разработки, простого GET запроса. Я протестировал и понял что всё работает. Создал пул реквест (или CR по амазоновски)
херак – конфликты. Ладно ещё час на их удаление снова тесты снова заливаю. Ура прошло но билд фэйлится, зависимости библиотек не загружены во внутренний
артифактори, да ёбанный пиздец. Ещё пару билдов и всё зелёное. Обновил коментарий – отправил на ревью.

Хочется сказать, вы что там охуели всё в конец. Мало того что вызов одного API стоит цент, так вся команда с разработкой этого API потратила несколько
десятков тысяч долларов. И это никогда не нуждается в scaling по горизонтали или по вертикали. Там трафика хуй с пальцем. Зачем так сложно и почему никто
не разбирается в технологиях и всё лепят как попало. Мир повернул не туда с cloud технологиями. Столько ресурсов тратиться зазря. Да даже хер с ним. Реально
простейший nginx сервер на дедике это потянул бы в невероятное число раз быстрее. На разработку не ушло бы столько времени, а уже тем более денег.

Так просто не должно быть... и AI тут не поможет, большую часть в создании этого API это разговоры с ничего не знающими людьми на местах которые они не 
должны занимать.

В итоге полный запрос примерно на 1200 строк. Это просто неправильно. Эти технологии в таком формате не нужны. Это компьютеризированная бюрократия.

--> [EN](why-is-it-so-complicated-to-write-apis-now-en.md) <--
