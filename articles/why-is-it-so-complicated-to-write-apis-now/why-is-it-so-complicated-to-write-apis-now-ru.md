## Почему так сложно создавать APIs в современном мире – компьютеризированная бюрократия

--> [EN](why-is-it-so-complicated-to-write-apis-now-en.md) <--

Сейчас на минуточку второе июля 2024 года. Я строю сайты с 2006 года и по сей день. Когда-то начиная с простейших HTML-страниц, хостящихся прямо с Apache сервера, сейчас всё вертится в облаке, деплоится автоматически через стек и хостится как-то, я если честно даже не знаю как. Могу только догадываться и верить предложенной документации.

Начну с конца. Чтобы написать простенький GET API для JSON файлов в 2024 году в корпорации Amazon, мне потребовалось реально практически месяц. Месяц работы включил планирование, создание контракта для API, его описание на языке представления Smithy (что, блять, это такое и зачем оно нужно), пару недель гонять пулл-реквест (в Амазоне он называется CR, нахуя, блять??) от одного разработчика до другого с комментариями. В итоге замерджил это через пару недель после создания запроса с 4-й ревизии. До этого в Амазоне у меня было максимум 3 ревизии, дно пробито. Блять, нахуя городить Smithy, я не знаю. В итоге я приступил к разработке самого API. Это просто REST GET запрос к серверу с одним параметром. Этот GET запрос должен выводить в прописанном в Smithy формате (ага, когда, блять, уже есть JSON) контент файла, который находится в JSON формате в сервисе AppConfig, выбирающемся в соответствии с заданным параметром в API.

Если словами быдло-кодера, это скрипт, который выдаёт файлы из сервера. Всё. Сам API я написал минут за 15, потому что пришлось час потратить на чтение документации по AppConfig и поиску API спецификации к нему. Строк кода, ну, 200 сам API.

В 2006 году Apache сервер мог прочитать и выдать файл в 3-4 строках, если в БД, то в 10 макс.

Хер с ним, написал, написал тесты, чтобы было покрытие 100%, получилось уже 500 добавочных строк. Дальше библиотеки, подключения новых параметров в стеке и сам стек.

Сам стек написан на внутреннем CDK на TypeScript. Что-то среднее между Terraform и скриптами быдло-кодеров в 2009 году для использования сервисами AWS. CDK служит для создания деплоймента в AWS и разбит на много компонентов. Но ключевые компоненты называются стэки. В стеках можно описать что угодно, хоть нахуй соседа послать, но обычно создают базы данных, лямбды, CloudFormation, да чего угодно. В моём случае API был оформлен как лямбда функция. Я добавил лямбду и начал смотреть спецификацию, которая требовала параметры для подключения лямбды к AppConfig. К моему расстройству, сам AppConfig был объявлен в другом стеке. И не как отдельный стек, а как ведомая часть другого сервисного стэка.

Когда я это увидел, на меня нахлынула ярость. Я уже и так дня 3 устанавливал стек на свой AWS Account для тестов. А тут, собственно, мне никак не получить параметры, нужные для чтения файлов из AppConfig, из другого стэка нормальным путём, кроме как переписать чужой стек и вычленить из него AppConfig, поместить в новый стек и сделать его как раздаваемую структуру.

Фух, подумал я, надо пройтись... достать Хаски-Колбаски и просто погулять, чтобы перестать думать об этой хуёвой работе. Немного отступления, чтобы ускорить работу, я часто прошу AI что-то сделать за меня. Это мне помогает настроиться на работу, потому что AI так плохо делает некоторые вещи, что я расстраиваюсь и начинаю переделывать. Аналогично и тут: после прогулки я решил, что надо попробовать дать AI шанс. Попробовал раз 5-6, у меня получилось из рук вон плохо. Редактор ругался на код, и его надо было переписывать. Но мелкие сгенерированные сниппеты я всё же получил.

Поигравшись с генератором кода, мне надо было поговорить с командой и убедить их, что нужен новый стек. А это, собственно, основная проблема: никто не любит переписывать то, что работает, и в итоге моя работа раздуется от этого. Но это полбеды. Все существующие стеки должны будут быть обновлены с аккуратным удалением, иначе деплоймент просто не будет работать. И это надо будет сделать всем, всем энвайронментам, всем девелоперам и их аккаунтам. Ладно, что делать, написал. Удивительно быстро получилось убедить всех. В целом это даже всех удивило, что это не был отдельный стек, и, видимо, кто-то получит по шапке.

Работа закипела, сделав новый стек, я расшарил параметры с моим лямбдовым и со старым тоже лямбдовым, но теперь облегчённым. Приятно смотреть на более чистый код. Написал тесты и новый стек, наверное, строк 300-400. Начал тестировать, и, конечно, проблемы с диплоем даже в мой рабочий аккаунт. Пару часов удалений и редеплоя – ура, появилось и работает.

Пошёл тестировать API, заливаю конфигурационные файлы, не работает часть, которая создаёт AppConfig. Она работала до того, как я приступил делать свою часть. Перебирая всё в голове, что я мог потрогать за время разработки, я понял, что ничего из этого не трогал, и это кто-то другой. Стал смотреть последние изменения и одновременно написал в чат, что такое. В итоге нашёл, что кто-то поставил доп. фильтры на загрузку конфигураций, и одновременно из чата пришло сообщение, что уже всё поменялось, пока я разрабатывал API. Ну хотя бы работает, подумал я, и, подправив файлы для фильтров, залил конфигурации. Они появились!!! УРА УРА!

Между делом уже идёт неделя разработки простого GET запроса. Я протестировал и понял, что всё работает. Создал пул реквест (или CR по-амазоновски), херак – конфликты. Ладно, ещё час на их удаление, снова тесты, снова заливаю. Ура, прошло, но билд фейлится, зависимости библиотек не загружены во внутренний артифактори, да ёбанный пиздец. Ещё пару билдов, и всё зелёное. Обновил комментарий – отправил на ревью.

Хочется сказать: вы что там, охуели все в конец? Мало того, что вызов одного API стоит цент, так вся команда с разработкой этого API потратила несколько десятков тысяч долларов. И это никогда не нуждается в скейлинге по горизонтали или по вертикали. Там трафика хуй с пальцем. Зачем так сложно, и почему никто не разбирается в технологиях, и всё лепят как попало? Мир повернул не туда с облачными технологиями. Столько ресурсов тратится зря. Да даже хер с ним. Реально простейший nginx сервер на дедике это потянул бы в невероятное число раз быстрее. На разработку не ушло бы столько времени, а уж тем более денег.

Так просто не должно быть... и AI тут не поможет, большую часть в создании этого API это разговоры с ничего не знающими людьми на местах, которые они не должны занимать.

В итоге полный запрос примерно на 1200 строк. Это просто неправильно. Эти технологии в таком формате не нужны. Это компьютеризированная бюрократия.

--> [EN](why-is-it-so-complicated-to-write-apis-now-en.md) <--
